# 项目变更记录

> 用途：记录每次代码修改的变更摘要、影响范围与时间，便于追踪与回溯。

## 2026-02-17
- 13:47 实现 v3.0 后续功能（T005-T026）：补齐 Prompt Builder 功能提示词构建接口；接入代码模板骨架渲染、按功能 AI 生成、existing_files 去重与 80% 行数策略；补齐 3 套代码模板与 6 类 HTML 模板；HTML 生成改为模板加载并注入 AI 页面变量；源码文档页脚改为“第X页 共Y页”；操作手册增加 TOC、安装配置与注意事项章节；申请表改为 Word 模板占位符替换并高亮手工字段；任务取消升级为协作式取消；新增 4 个自动化测试文件并通过测试。
- 影响文件：
  - `server/ai/prompt_builder.py`
  - `server/generators/feature_generator.py`
  - `server/generators/code_generator.py`
  - `server/generators/html_page_generator.py`
  - `server/generators/source_doc_generator.py`
  - `server/generators/manual_doc_generator.py`
  - `server/generators/application_doc_generator.py`
  - `server/generators/orchestrator.py`
  - `server/generators/consistency_checker.py`
  - `server/task/task_manager.py`
  - `server/api/task.py`
  - `server/code_templates/springboot_vue/README.md.tpl`
  - `server/code_templates/springboot_vue/docs/architecture.md.tpl`
  - `server/code_templates/springboot_vue/backend/src/main/java/com/example/Application.java.tpl`
  - `server/code_templates/springboot_vue/frontend/src/main.js.tpl`
  - `server/code_templates/springboot_vue/frontend/src/App.vue.tpl`
  - `server/code_templates/flask_vue/README.md.tpl`
  - `server/code_templates/flask_vue/docs/architecture.md.tpl`
  - `server/code_templates/flask_vue/backend/app.py.tpl`
  - `server/code_templates/flask_vue/frontend/src/main.js.tpl`
  - `server/code_templates/flask_vue/frontend/src/App.vue.tpl`
  - `server/code_templates/django_vue/README.md.tpl`
  - `server/code_templates/django_vue/docs/architecture.md.tpl`
  - `server/code_templates/django_vue/backend/manage.py.tpl`
  - `server/code_templates/django_vue/frontend/src/main.js.tpl`
  - `server/code_templates/django_vue/frontend/src/App.vue.tpl`
  - `server/html_templates/login.html`
  - `server/html_templates/dashboard.html`
  - `server/html_templates/list.html`
  - `server/html_templates/form.html`
  - `server/html_templates/detail.html`
  - `server/html_templates/chart.html`
  - `server/template/application_template.docx`
  - `server/tests/test_ai_client.py`
  - `server/tests/test_generators.py`
  - `server/tests/test_screenshot.py`
  - `server/tests/test_consistency.py`
  - `docs/设计文档_v3.0_未实现功能清单.md`
  - `docs/项目变更记录.md`
- 13:32 完成 v3.0 未实现清单前 4 项（T001-T004）：新增 4 个提示词模板文件，并为任务清单新增“已完成标记”列，标记前 4 项为“已完成”。
- 影响文件：
  - `server/ai/prompts/feature_gen.txt`
  - `server/ai/prompts/code_gen.txt`
  - `server/ai/prompts/manual_gen.txt`
  - `server/ai/prompts/page_gen.txt`
  - `docs/设计文档_v3.0_未实现功能清单.md`
  - `docs/项目变更记录.md`
- 新增规则：每次代码修改后必须同步更新本文件。
- 影响文件：
  - `AGENTS.md`
- 14:30 补齐文件过期清理能力：新增后台定时清理线程，按保留时长自动清理 `output/`、`screenshots/`、`data/tasks/*.json` 与 `data/tasks/checkpoints/*.json`。
- 影响文件：
  - `server/utils/file_manager.py`
  - `server/app.py`
  - `server/config.py`
  - `server/.env.example`
- 14:35 补齐基础自动化测试：新增申请表模板 POC 测试、代码检查器单测、文件清理器单测，并通过 `unittest` 验证。
- 影响文件：
  - `server/tests/test_application_doc_poc.py`
  - `server/tests/test_code_checker.py`
  - `server/tests/test_file_manager.py`
  - `docs/项目变更记录.md`
- 13:09 新增《系统当前架构与流程梳理》文档，系统化梳理前后端分层、核心模块职责、六步流水线、状态存储、降级机制与端到端调用流程。
- 影响文件：
  - `docs/系统当前架构与流程梳理.md`
  - `docs/项目变更记录.md`
- 13:10 通义接口从 OpenAI 兼容模式切换为 DashScope AIGC Text Generation 接口（`/api/v1/services/aigc/text-generation/generation`），并支持 SSE 增量解析。
- 影响文件：
  - `server/ai/adapters/tongyi_adapter.py`
  - `server/config.py`
  - `server/.env.example`
- 13:02 服务端关键接口补充入参/出参日志，覆盖 `/generate`、`/tech-stacks`、`/task`、`/task/<task_id>/stream`、`/task/<task_id>/cancel`、`/download`、`/download/<task_id>/all` 的成功与失败分支，便于排查请求链路。
- 影响文件：
  - `server/api/generate.py`
  - `server/api/task.py`
  - `server/api/download.py`
  - `docs/项目变更记录.md`
- 13:27 基于 `docs/设计文档_v3.0.md` 与当前代码实现差异，新增“未实现功能最小任务清单”文档，按最小可实现单位拆分待办任务并附验收标准。
- 影响文件：
  - `docs/设计文档_v3.0_未实现功能清单.md`
  - `docs/项目变更记录.md`
