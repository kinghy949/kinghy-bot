# 软著材料生成系统开发计划 v1.0

## 背景与目标

开发一个基于Web的软著材料自动生成系统，用户输入软著名称和项目描述后，系统自动生成符合中国版权保护中心标准格式的：
1. 源代码文档（包含格式化的代码、行号、页眉页脚）
2. 使用说明文档（包含目录、截图、模板化内容）

两份文档均为Word格式（.docx），可直接用于软著申请。

## 技术栈

- **后端框架**: Flask (Python)
- **Word文档处理**: python-docx
- **AI集成**: OpenAI API / Claude API（可配置）
- **前端**: HTML + CSS + JavaScript (Bootstrap美化)
- **代码格式化**: Pygments (语法高亮)
- **异步处理**: Celery + Redis（处理AI生成的长时间任务）
- **文件存储**: 本地文件系统

## 核心功能模块

### 1. Web界面模块
- 用户输入表单：
  - 软著名称（必填）
  - 项目简单描述（一句话，必填）
  - 项目类型选择（Web应用/桌面应用/移动应用/API服务）
  - 技术栈选择（根据项目类型动态显示）
  - 目标代码行数（默认5000行，可调整）
  - 截图上传（用于使用说明文档，可选）
- 生成进度显示（AI生成需要时间）
- 结果下载页面

### 2. AI代码生成模块
- **提示词构建器** (`prompt_builder.py`)：
  - 根据项目类型和描述构建AI提示词
  - 包含代码行数要求
  - 指定代码结构和文件组织

- **AI客户端** (`ai_client.py`)：
  - 封装OpenAI/Claude API调用
  - 支持流式响应（实时显示生成进度）
  - 错误重试机制

- **代码验证器** (`code_validator.py`)：
  - 验证生成的代码语法正确性
  - 统计代码行数
  - 检查代码完整性（是否有主文件、配置等）

- **代码扩展器** (`code_expander.py`)：
  - 如果代码行数不足5000行，自动补充
  - 添加更多功能模块、注释、文档字符串
  - 生成测试文件、配置文件等

### 3. 源码文档生成模块
按照软著要求格式化源代码：
- 页面设置：A4纸张，上下边距2.54cm，左右边距3.17cm
- 页眉："{软著名称}源程序"，宋体小五号
- 页脚：页码（居中），"第X页 共Y页"
- 行号：每行代码前添加行号（右对齐，4位数字）
- 字体：代码使用Courier New 小四号
- 提取规则：前60页 + 后30页（共90页，约3000行代码）
- 如果代码不足90页，则全部输出

### 4. 使用说明文档生成模块
基于AI生成的代码信息，自动生成使用说明：
- **封面页**：
  - 软著名称
  - 版本号（V1.0）
  - 编写日期

- **自动生成目录**（使用Word样式）

- **标准章节**：
  1. **引言**
     - 1.1 编写目的
     - 1.2 项目背景
     - 1.3 术语定义

  2. **运行环境**
     - 2.1 硬件环境
     - 2.2 软件环境（根据技术栈自动填充）
     - 2.3 网络环境

  3. **安装与配置**
     - 3.1 安装步骤（根据项目类型生成）
     - 3.2 配置说明
     - 3.3 启动方法

  4. **功能说明**
     - 4.1 功能概述（根据AI生成的代码分析）
     - 4.2 主要功能模块
     - 4.3 操作流程（插入截图）

  5. **注意事项**
     - 5.1 使用限制
     - 5.2 常见问题

- **截图插入**：用户上传的截图自动插入到相应章节
- **格式规范**：标题使用黑体，正文使用宋体，行间距1.5倍

### 5. 文档下载模块
- 生成两个Word文档
- 打包为ZIP文件供用户下载
- 文件命名规范：`{软著名称}_源程序.docx` 和 `{软著名称}_使用说明.docx`

## 项目结构

```
kinghy-bot/
├── app.py                      # Flask主应用
├── requirements.txt            # Python依赖
├── config.py                   # 配置文件（API密钥等）
├── .env.example                # 环境变量示例
├── ai/                         # AI集成模块
│   ├── __init__.py
│   ├── ai_client.py           # AI API客户端
│   ├── prompt_builder.py      # 提示词构建器
│   └── prompts/               # 提示词模板
│       ├── web_app.txt
│       ├── desktop_app.txt
│       ├── mobile_app.txt
│       └── api_service.txt
├── generators/                 # 生成器模块
│   ├── __init__.py
│   ├── code_generator.py      # AI代码生成协调器
│   ├── code_validator.py      # 代码验证器
│   ├── code_expander.py       # 代码扩展器
│   ├── source_doc_generator.py # 源码文档生成器
│   └── manual_doc_generator.py # 使用说明生成器
├── utils/                      # 工具函数
│   ├── __init__.py
│   ├── code_formatter.py      # 代码格式化
│   ├── line_counter.py        # 代码行数统计
│   ├── docx_helper.py         # Word文档辅助函数
│   └── file_manager.py        # 文件管理
├── static/                     # 静态资源
│   ├── css/
│   │   └── style.css
│   ├── js/
│   │   └── main.js
│   └── uploads/               # 用户上传的截图
├── templates/                  # Flask模板
│   ├── index.html             # 主页面
│   ├── progress.html          # 生成进度页面
│   └── result.html            # 结果页面
├── output/                     # 生成的文档输出目录
│   └── .gitkeep
└── tests/                      # 测试文件
    ├── test_ai_client.py
    ├── test_code_generator.py
    └── test_doc_generator.py
```
